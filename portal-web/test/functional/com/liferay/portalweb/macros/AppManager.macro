<definition>
	<command name="deactivateAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="Click" locator1="AppManager#APP_ACTIONS" />

		<execute function="AssertClickNoError" locator1="MenuItem#ANY_MENU_ITEM" value1="Deactivate">
			<var name="key_menuItem" value="Deactivate" />
		</execute>

		<execute function="Confirm" value1="Are you sure you want to deactivate this?" />
	</command>

	<command name="selectAppCP">
		<var name="key_appName" value="${appName}" />

		<while>
			<condition function="IsElementNotPresent" locator1="AppManager#APP_NAME" />
			<then>
				<execute function="Click" locator1="Pagination#NEXT_LINK" />
			</then>
		</while>

		<execute function="AssertClick" locator1="AppManager#APP_NAME" value1="${appName}" />
	</command>

	<command name="uninstallAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="AssertClick" locator1="AppManager#APP_ACTIONS" value1="Actions" />

		<execute function="AssertClickNoError" locator1="MenuItem#ANY_MENU_ITEM" value1="Uninstall">
			<var name="key_menuItem" value="Uninstall" />
		</execute>

		<execute function="Confirm" value1="Are you sure you want to uninstall this?" />

		<execute function="Pause" locator1="15000" />
	</command>

	<command name="uploadAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="Click" locator1="Portlet#OPTIONS_ICON" />

		<execute function="AssertClick" locator1="MenuItem#ANY_MENU_ITEM" value1="Upload">
			<var name="key_menuItem" value="Upload" />
		</execute>

		<execute function="SelectFrame" locator1="IFrame#DIALOG" />

		<execute function="AssertElementPresent" locator1="Button#BROWSE" />

		<execute function="Click" locator1="Button#BROWSE" />

		<execute function="SikuliClick" locator1="OS#FILE_DIALOG_BOX_TYPE_FILE_NAME_ICON_PNG" />

		<execute function="SikuliUploadCommonFile" locator1="OS#FILE_DIALOG_BOX_FILE_NAME_FIELD_PNG" value1="${warFileName}" />

		<execute macro="Button#clickInstall" />

		<execute function="AssertTextEquals" locator1="Message#SUCCESS_3" value1="The plugin was uploaded successfully and is now being installed." />

		<execute function="SelectFrame#selectFrameTop" />

		<execute function="Click" locator1="Modal#CLOSE_BUTTON" />

		<while>
			<condition function="AssertConsoleTextNotPresent" value1="STARTED ${appName}" />
			<then>
				<execute function="Pause" locator1="1000" />
				<var method="MathUtil#sum('${uploadTime}', '1')" name="uploadTime" />

				<if>
					<equals arg1="${uploadTime}" arg2="30" />
					<then>
						<fail message="Manual app installation exceeded 30s. Please check status in console." />
					</then>
				</if>
			</then>
		</while>

		<execute function="Pause" locator1="3000" />

		<execute function="AssertConsoleTextNotPresent" value1="HotDeployException: Error initializing Spring for ${appName}" />
		<execute function="AssertConsoleTextNotPresent" value1="HotDeployException: Error registering hook for ${appName}" />
		<execute function="AssertConsoleTextNotPresent" value1="HotDeployException: Error registering portlets for ${appName}" />
	</command>

	<command name="viewAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="AssertTextEquals#assertPartialText" locator1="AppManager#APP_NAME" value1="${appName}" />
	</command>

	<command name="viewNoAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="AssertElementNotPresent" locator1="AppManager#APP_NAME" value1="${appName}" />

		<while>
			<condition function="IsElementPresent" locator1="Pagination#NEXT_LINK" />
			<then>
				<execute function="Click" locator1="Pagination#NEXT_LINK" />

				<execute function="AssertElementNotPresent" locator1="AppManager#APP_NAME" value1="${appName}" />
			</then>
		</while>
	</command>

	<command name="viewStatus">
		<var name="key_appName" value="${appName}" />
		<var name="key_appStatus" value="${appStatus}" />

		<execute function="AssertTextEquals#assertPartialText" locator1="AppManager#APP_STATUS" value1="${appStatus}" />
	</command>

	<command name="viewUninstallAppCP">
		<var name="key_appName" value="${appName}" />

		<execute function="AssertElementNotPresent" locator1="AppManager#APP_NAME" value1="${appName}" />
	</command>
</definition>